# 测试流程 / Testing Process

本文档介绍每日打卡 Pro 项目的测试流程，包括功能测试和测试用例。

This document describes the testing process for Daily Check-in Pro, including functional tests and test cases.

---

## 测试环境 / Testing Environment

- **前端**: 微信开发者工具
- **后端**: 本地开发服务器
- **数据库**: 本地 MySQL
- **测试工具**: 微信开发者工具模拟器 + Postman（API 测试）

---

## 测试准备 / Test Preparation

### 1. 准备测试账号

- 后台准备一个有效的微信 AppID 和 Secret
- 至少准备两个微信账号用于测试团队和社交功能

### 2. 准备测试数据

```sql
-- 清空测试数据（谨慎操作）
DELETE FROM CheckInRecord WHERE userId = 'test-user-id';
DELETE FROM CheckInItem WHERE userId = 'test-user-id';
DELETE FROM User WHERE openid = 'test-openid';
```

### 3. 启动测试环境

```bash
# 启动后端
cd backend/daily-check-in-api
npm run start:dev

# 启动前端
cd frontend/daily-check-in-app
npm run dev
```

---

## 功能测试用例 / Functional Test Cases

### 1. 用户模块 / User Module

#### 1.1 微信登录

| 测试步骤 | 预期结果 |
|---------|---------|
| 打开小程序，点击「登录」按钮 | 调用微信 `wx.login` 获取 code |
| 后端收到 code，请求微信服务器获取 openid | 返回用户信息和 JWT token |
| 登录成功后跳转到首页 | 显示用户昵称和头像 |
| 退出登录后重新登录 | 自动识别已注册用户 |

#### 1.2 个人信息管理

| 测试步骤 | 预期结果 |
|---------|---------|
| 点击「我的」页面 | 显示用户信息和积分 |
| 点击编辑昵称 | 弹出修改框，保存后更新显示 |
| 查看当前积分 | 显示累计积分和今日打卡状态 |

---

### 2. 打卡模块 / Check-in Module

#### 2.1 创建打卡项目

| 测试步骤 | 预期结果 |
|---------|---------|
| 点击「+」创建打卡 | 打开创建页面 |
| 填写名称「晨练」、备注 | 输入框正常工作 |
| 保存按钮 | 提示创建成功，返回列表 |
| 列表显示新创建的项目 | 显示项目名称和连续打卡天数 |

#### 2.2 提交打卡

| 测试步骤 | 预期结果 |
|---------|---------|
| 点击某个打卡项目 | 进入详情页 |
| 显示今日未打卡状态 | 显示「立即打卡」按钮 |
| 点击「立即打卡」 | 提示「打卡成功+5积分」 |
| 连续打卡天数 +1 | 更新显示 |
| 首页显示打卡动画 | 有视觉反馈 |

#### 2.3 补签功能

| 测试步骤 | 预期结果 |
|---------|---------|
| 查看历史记录，找到某天缺失 | 记录显示为灰色 |
| 点击补签按钮 | 弹窗提示「补签需要消耗10积分」 |
| 确认补签 | 提示「补签成功」，积分-10 |
| 记录标记为补签状态 | 显示黄色标签 |

#### 2.4 重复打卡

| 测试步骤 | 预期结果 |
|---------|---------|
| 今天已打卡，再次点击 | 提示「今日已打卡」 |
| 积分不会重复增加 | 积分保持不变 |

---

### 3. 积分勋章模块 / Incentive Module

#### 3.1 积分获取

| 场景 | 预期获取 |
|-----|---------|
| 每日打卡 | +5 积分 |
| 创建打卡项目 | +2 积分 |
| 发布动态 | +1 积分 |

#### 3.2 积分消耗

| 场景 | 预期消耗 |
|-----|---------|
| 补签一天 | -10 积分 |

#### 3.3 积分记录

| 测试步骤 | 预期结果 |
|---------|---------|
| 进入积分页面 | 显示当前总积分 |
| 查看积分明细 | 显示所有积分变动记录 |
| 记录包含原因和时间 | 格式正确 |

#### 3.4 勋章获取

| 勋章 | 获取条件 |
|-----|---------|
| 坚持不解 | 连续打卡 3 天 |
| 七日挑战 | 连续打卡 7 天 |
| 三十连胜 | 连续打卡 30 天 |
| 累计百次 | 累计打卡 100 次 |

| 测试步骤 | 预期结果 |
|---------|---------|
| 达到勋章条件 | 自动解锁勋章 |
| 进入勋章页面 | 显示已获得的勋章 |
| 不同稀有度显示不同颜色 | 普通/稀少=紫色，传说=金色 |

---

### 4. 社交模块 / Social Module

#### 4.1 发布动态

| 测试步骤 | 预期结果 |
|---------|---------|
| 点击发布按钮 | 打开发布页面 |
| 输入内容，上传图片 | 内容正常输入 |
| 点击发布 | 提示发布成功 |
| 动态出现在社区列表 | 时间排序正确 |

#### 4.2 点赞功能

| 测试步骤 | 预期结果 |
|---------|---------|
| 点击他人动态的点赞按钮 | 图标变红，点赞数+1 |
| 再次点击 | 取消点赞，图标恢复，点赞数-1 |
| 刷新页面 | 点赞状态保持 |

#### 4.3 评论功能

| 测试步骤 | 预期结果 |
|---------|---------|
| 点击评论按钮 | 显示评论输入框 |
| 输入评论内容 | 输入框正常工作 |
| 发送评论 | 评论立即显示 |
| 刷新页面 | 评论保持显示 |

#### 4.4 团队管理

| 测试步骤 | 预期结果 |
|---------|---------|
| 创建团队「早起打卡团」 | 提示创建成功 |
| 分享团队邀请码 | 显示邀请码 |
| 另一账号输入邀请码 | 成功加入团队 |
| 查看团队成员列表 | 显示所有成员 |

#### 4.5 排行榜

| 测试步骤 | 预期结果 |
|---------|---------|
| 进入排行榜页面 | 显示排名列表 |
| 按积分排序显示 | 排序正确 |
| 显示前三名特殊样式 | 有皇冠/奖牌标识 |
| 切换团队/个人榜单 | 内容相应切换 |

---

### 5. 通知模块 / Notification Module

| 测试步骤 | 预期结果 |
|---------|---------|
| 创建团队后 | 收到「团队创建成功」通知 |
| 有人加入团队 | 团队成员收到通知 |
| 有人发布动态 | 团队成员收到通知 |
| 点击通知 | 跳转到对应页面 |
| 未读通知有红点 | 红点样式正确 |

---

## API 接口测试 / API Testing

使用 Postman 测试后端接口，需先获取 token。

### 1. 获取 Token

```http
POST http://localhost:3000/auth/login
Content-Type: application/json

{
  "code": "test_wechat_code"
}
```

返回：
```json
{
  "code": 0,
  "data": {
    "token": "eyJhbGc...",
    "user": {
      "id": "xxx",
      "nickname": "测试用户",
      "avatar": "https://..."
    }
  }
}
```

### 2. 测试带认证请求

将返回的 token 添加到请求头：

```
Authorization: Bearer eyJhbGc...
```

### 3. 接口测试清单

| 接口 | 方法 | 测试点 |
|------|------|--------|
| `/auth/login` | POST | 是否正确返回 token |
| `/user/profile` | GET | 是否正确获取用户信息 |
| `/checkin/items` | GET | 是否正确返回项目列表 |
| `/checkin/items` | POST | 是否成功创建项目 |
| `/checkin/:itemId/submit` | POST | 是否成功打卡 |
| `/social/posts` | GET | 是否正确返回动态列表 |
| `/social/posts` | POST | 是否成功发布动态 |
| `/social/posts/:id/like` | POST | 点赞/取消点赞是否生效 |
| `/incentive/medals` | GET | 是否正确返回勋章列表 |

---

## 性能测试 / Performance Testing

### 1. 页面加载时间

| 页面 | 目标时间 |
|------|---------|
| 首页（打卡列表） | < 500ms |
| 个人中心 | < 300ms |
| 社区动态 | < 500ms |
| 积分/勋章页 | < 400ms |

### 2. 接口响应时间

| 接口 | 目标时间 |
|------|---------|
| 登录 | < 1s |
| 获取打卡列表 | < 300ms |
| 提交打卡 | < 500ms |
| 获取动态列表 | < 400ms |

---

## 兼容性测试 / Compatibility Testing

### 微信版本

| 微信版本 | 测试状态 |
|---------|---------|
| 最新版本 | ✓ 通过 |
| 近三个版本 | ✓ 通过 |

### 手机系统

| 系统 | 测试状态 |
|------|---------|
| iOS 最新版本 | ✓ 待测 |
| Android 10+ | ✓ 待测 |

---

## 边界条件测试 / Boundary Testing

| 场景 | 测试点 |
|------|--------|
| 空输入 | 各输入框能否正常处理空字符串 |
| 超长输入 | 昵称、动态内容长度限制 |
| 网络断开 | 断网时友好的错误提示 |
| 接口超时 | 接口响应慢时的用户体验 |
| 并发打卡 | 同时提交多次打卡的幂等性 |
| 积分不足 | 积分不够补签时的提示 |

---

## 安全测试 / Security Testing

| 测试项 | 说明 |
|--------|------|
| JWT 过期 | 使用过期 token 访问应返回 401 |
| 无效 Token | 使用伪造 token 访问应返回 401 |
| 登录防刷 | 同一用户短时间内多次登录的限流 |
| 数据权限 | 用户只能修改/删除自己的数据 |
| SQL 注入 | Prisma ORM 自动防护 |

---

## 测试报告模板 / Test Report Template

```
测试日期: YYYY-MM-DD
测试人员: xxx
测试环境: 开发/测试/预发/生产

一、功能测试通过率: XX/XX (XX%)
二、Bug 列表:
   - [严重] 描述
   - [一般] 描述
   - [轻微] 描述
三、测试结论: 通过/不通过/带条件通过
```

---

## 常见问题排查 / Troubleshooting

### 1. 测试时登录失败

- 检查微信 AppID 和 Secret 是否正确
- 确认测试账号的 code 是否在有效期（5分钟）

### 2. 打卡不成功

- 检查网络连接
- 查看后端日志确认处理逻辑
- 确认数据库中记录状态

### 3. 积分未增加

- 检查积分奖励是否已触发
- 查看后端日志确认积分发放逻辑
- 刷新页面重新获取最新数据
